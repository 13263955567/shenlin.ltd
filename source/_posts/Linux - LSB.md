---
title: Linux - LSB
categories:
  - Linux
tags:
  - Linux
  - LSB
---


<!--more-->


什么是LSB

  LSB，即Linux标准规范(英语:Linux Standard Base)是一个在Linux基金会结构下对Linux发行版的联合项目,使Linux操作系统符合软件系统架构,或文件系统架构标准的规范及标准。LSB基于POSIX,统一UNIX规范及其他开放标准,共在某些领域扩展它们。详细情况请参考相关链接。 

LSB脚本动作

由LSB应用程序提供的脚本应该需要接受一个指示其动作(action)的参数，目前包括：

·start 启动服务

·stop 停止服务

·restart 如果服务在运行，则先停止，再启动，否则启动服务

·try-restart 如果服务正在运行，重启服务

·reload 不通过重启服务的方式重新加载配置文件

·force-reload 如果服务支持的话，重新加载配置文件，否则重启服务

·status 打印服务的当前状态

start,stop,restart,force-reload 和status是所有lsb脚本必须支持的；reload和try-restart是可选的。当然自己也可以定义别的一些动作。

在下列情况下，lsb脚本要求确保对其接受的动作(action)有其明确且合理的行为

·         服务已经启动，然后调用start

·         服务已经停止，然后调用stop

对于这些行为，为了满足其一致性，最好使用/lib/lsb/init-functions脚本(后面分析)

在主流的Linux发行版版本中,一个软件包卸载(remove)时,并不会讲一些脚本,配置文件同时删除,除非你强制指定为清除(purge).因此,在你的lsb脚本最前面应该包括一个判断真正的可执行文件是否存在,类似于下面这个样子:

[ -x /usr/sbin/ifconfig ] || exit 5

如果调用status动作,lsb脚本应该根据其状态返回下面的值:

·         0 程序正在运行,或者服务正常

·         1 程序已死,但/var/run/下的pid文件还存在(或者在别的位置)

    2 程序已死,但/var/lock/下的锁文件还存在(或者在别的位置)
    3 程序没有运行

·         4 程序或者服务状态未知

·         5-99 LSB为扩展保留

·         100-149 为发行版本使用保留

·         150-199 为应用程序使用保留

·         200-254 保留

·          除status动作外,指定其他动作,lsb脚本必须返回状态值(exit $?),如果完成动作其他的结果,返回为0,否则应该根据动作情况,返回下列值之一:

·         1 通用(generic)错误或者非规范化错误

·         2 无效参数,或者参数过多

·         3 未实现的特性(比如reload)

·         4 用户权限不够

·         5 程序没有安装

·         6 程序没有配置

·         7 程序没有运行

·         8-99 LSB为扩展保留

·         100-149 为发行版本保留

·         150-199 为应用程序使用保留

·         200-254 保留

·             错误和状态消息应该通过日志函数来输出，比如lsb提供的log_failure_msg。

因为lsb脚本有可能是由系统管理员在非标准的环境下手工运行,比如没有PATH,USER,LOGNAME等环境变量.因此lsb脚本不能依赖环境变量,它需要自己设定自己需要的变量或者使用缺省值.
