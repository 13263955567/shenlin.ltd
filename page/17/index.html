<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="A Programmer&apos;s Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="shenlin&#39;s blog">
<meta property="og:url" content="http://www.shenlin.ltd/page/17/index.html">
<meta property="og:site_name" content="shenlin&#39;s blog">
<meta property="og:description" content="A Programmer&apos;s Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="shenlin&#39;s blog">
<meta name="twitter:description" content="A Programmer&apos;s Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.shenlin.ltd/page/17/"/>





  <title>shenlin's blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">shenlin's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">what the fuck?!</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.shenlin.ltd/2017/12/30/PHP笔记/细说 PHP - 错误和异常/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shenlin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="shenlin's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/30/PHP笔记/细说 PHP - 错误和异常/" itemprop="url">细说 PHP - 错误和异常</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-30T07:12:42+08:00">
                2017-12-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>错误类型<br>    1、语法错误<br>    2、运行时错误<br>    3、逻辑错误</p>
<p>错误报告<br>    php配置文件中和错误相关的搜”Error handling and logging”<br>    或<br>    使用下列PHP函数设置错误报告：</p>
<pre><code>    error_reporting(E_ALL &amp; ~E_NOTICE &amp; E_WARNING);

    ini_set(&quot;error_reporting&quot;,E_ALL);


    echo ini_get(&quot;error_reporting&quot;);

错误 E_ERROR
警告 E_WARNING
注意 E_NOTICE


getType($var); //注意，程序仍继续执行
getType(); //警告，程序仍继续执行
getType() //错误，程序终止执行

上面的语句加@可临时屏蔽掉所有的注意、警告和错误，即：

@getType($var); 
@getType(); 
@getType() 
</code></pre><p>错误日志</p>
<pre><code>1、指定错误日志
    ini_set(&quot;error_reporting&quot;,E_ALL);
2、关闭错误输出
    ini_set(&quot;display_errors&quot;,&quot;off&quot;); 
    设置此值发生错误将不输出到浏览器
    如果不指定错误日志位置，将默认写入web服务器的错误日志中，如apache错误日志
    若此值设置为true，则输出到浏览器，但不会再写入apache错误日志
3、开启错误日志功能
    ini_set(&quot;log_errors,&quot;on&quot;);
4、指定错误日志文件
    ini_set(&quot;error_log&quot;,&quot;c:/error.log&quot;);

    设置为syslog则将错误写入了操作系统的错误日志中：
    ini_set(&quot;error_log&quot;,&quot;syslog&quot;);
5、使用函数产生错误日志    
    error_log(&quot;this is a error message&quot;);


建议开发时输出所有的错误报告，有利于进行程序调试；运行阶段不要输出任何错误报告。
</code></pre><p>异常处理<br>    意外，程序运行过程中发生的意料之外的事<br>    是php5的一个新特性</p>
<pre><code>try{

    throw new Exception(&quot;xxx失败&quot;);

    throw new MyException1(&quot;xxx失败&quot;);

    throw new MyException2(&quot;xxx失败&quot;);

}catch(MyException1 $异常参数){

}
}catch(MyException2 $异常参数){

}
}catch(Exception $异常参数){    //将系统的Exception处理放最后，这样如果Exception的子类没有对应的catch，则会交给Exception类

}

1、如果try中代码没有问题，则不执行catch代码
2、如果try中有异常发生，则在try中抛出异常对象，且抛给了catch中的异常参数，抛出异常后try中的代码中断执行，跳转到catch中去执行
3、我们主要做的不是提示发生了什么异常，而是要在catch中解决这个异常，解决不了，则输出给用户。
</code></pre><p>内置异常类和自定义异常类</p>
<pre><code>1、自定义异常类必须是内置异常类的子类
2、内置异常类只要构造方法和toString可以重载，其他都是final
3、自定义异常类应该是解决当发生此异常时的处理，即在这里换种方法实现发生异常代码要完成的功能，而不是通知
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.shenlin.ltd/2017/12/30/PHP笔记/细说 PHP - 文件处理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shenlin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="shenlin's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/30/PHP笔记/细说 PHP - 文件处理/" itemprop="url">细说 PHP - 文件处理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-30T07:11:23+08:00">
                2017-12-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>文件处理概述<br>    1、文件处理都是使用系统函数完成的<br>    2、这些函数都是基于linux/unix系统为模型</p>
<p>文件处理<br>    1、获取文件类型<br>        windows中只能获取file、dir、unknown三种类型<br>        linux中的所有类型均可获取：block、char、dir、fifo、file、link、unknown<br>            block：块设备文件，如磁盘分区，软驱，光驱<br>            char：字符设备，I/O中以字符为单位的设备，如键盘、打印机<br>            dir：目录也是文件的一种<br>            fifo：命令管道，信息从一个进程传入另一个进程<br>            file：普通文件<br>            link：链接文件</p>
<pre><code>    filetype(目录或文件名);
    is_dir();
    is_file();
    is_link();
    is_writable(); 别名 is_writeable();
    is_readable();
    is_executable();
    is_uploaded_file(); //判断文件是否通过HTTP POST上传
2、获取文件属性
    file_exists();
    filesize();
    filectime(); //inode修改时间，并不是创建时间，很多unix文件系统没有创建时间
    filemtime(); //文件内容修改时间
    fileatime(); //最后访问时间
    stat();    

3、和文件路径相关的函数

    路径分隔符
        linux/unix      /
        windows        \
            因\同时也是转义字符，因此在双引号中，使用\做分隔符时，需要其避免和后面的字符组成转义字符，需要使用两个\
            &quot;c:\\windows\\ntext&quot;

        分隔符常量：DIRECTORY_SEPARATOR 在不同系统上，会自动转换

        不管什么系统，PHP的目录分隔符都支持/

        PHP和Apache的配置文件中，也都使用/做为分隔符

    相对路径
        .    当前目录
        ..    上一级目录

        ./login.php 和 login.php 效果相同

    绝对路径
        /    根路径，存在两种情况
            客户端访问服务器端文件时，是通过apache访问，apache只能管理网站目录，所以根指的是网站根目录
                echo &quot;&lt;img src=&apos;/logo.gif&apos;&gt;&quot;;    
            在服务器中执行路径，根指的是操作系统根目录
                file_put_contents(&quot;/aaa.txt&quot;,&quot;abc&quot;);

    basename();
    dirname();
        可以通过嵌套取得上级的上级目录
        dirname(dirname(&quot;./aaa/bbb/ccc.php&quot;));
    pathinfo();

4、文件操作

    创建文件
        touch();
    删除文件
        unlink();
    移动文件/为文件重命名
        rename(&quot;当前文件路径&quot;,&quot;目标文件路径&quot;);
    复制文件
        copy(&quot;当前文件路径&quot;,&quot;目标文件路径&quot;);

    以上操作需要PHP执行对应文件的权限，即apache对应的用户有此权限

    和权限设置相关的函数：
        chgrp
            改变文件所属组
        chown
            改变文件所有者
        chmod
            改变文件模式

        filegroup
        fileowner

5、读写文件内容

    file_get_contents(); //需php5支持
        读取文件中全部内容后并返回
    file_put_contents(); //需php5支持
        文件不存在，则自动创建后再写入内容
        文件存在，则覆盖文件内容
        不能追加内容，也不能加锁

    file();
        读取文件全部内容并返回数组，每行为一个元素
    readfile();
        读取文件中全部内容后并全部输出

    fopen();
        返回值：成功返回资源类型，失败返回false
        参数1：文件路径
        参数2： r    以只读的模式打开
            r+    除了读，还可以写
            w    以只写的方式打开，文件不存在，则创建文件并写入，文件存在则覆盖原内容
            w+    除了写，还可以读
            x
            x+
            a    以只写的方式打开，文件不存在，则创建文件并写入，文件存在则在原文件内容后追加
            a+
            b    以二进制模式打开文件，如图片、电影，但需要和r、w联合起来使用，如rb、wb
            t    以文本模式打开文件
    fclose();
        资源类型需要关闭，再次读取时也需要先关闭再打开

    fwrite(); //别名fputs();
        参数1：fopen返回的文件资源
        参数2：写的内容

    fread();
        参数1：fopen返回的文件资源
        参数2：读取指定长度字符


        读取本地文件中的全部内容，使用filesize
        $file=fopen(&quot;demo.php&quot;,&quot;r&quot;);
        echo fread($file,filesize($file));
        fclose($file);

        读取远程文件中的全部内容，使用feof
        $str=&quot;&quot;;
        $file=fopen(&quot;http://www.163.com/&quot;,&quot;r&quot;);
        while(!feof($file)){
            $str.=fread($file,1024);
        }
        fclose($file);
        echo $str;

        feof();
            参数：文件资源
            如果文件打开错误或到文件末尾则出错

    fgetc();
        一次从文件中读取一个字符
    fgets();
        一次从文件中读取一行字符

    以上函数支持本地和远程文件，如远程 echo file_get_contents(&quot;http://www.163.com/&quot;);

6、文件内部指针移动
    ftell();
        返回当前文件指针位置
    fseek();
        移动文件指针
    rewind();
        移动指针到文件头部

7、文件锁定的机制处理
    flock();
        为文件加锁，释放文件锁
</code></pre><p>目录处理</p>
<pre><code>不同于文件的各种操作都有系统函数，目录的各种操作都需要自己编写函数，创建目录除外。

1、遍历目录
    opendir();
    readdir();
    closedir();
    rewinddir();
    is_dir();
2、创建目录
    mkdir();
3、删除目录
    rmdir();
        删除空目录
        自己编写删除非空目录
4、重命名/移动目录
    prename();
4、复制目录
    自己编写
5、统计目录大小
    自己编写
</code></pre><p>文件上传</p>
<pre><code>PHP配置文件中和上传文件有关的选项

    file_uploads = on
        允许使用php上传文件

    upload_max_filesize = 200M    
        最大不要超过系统内存

    post_max_size = 250M
        此项值除了包含上传文件本身外，还包括表单的其他数据，如商品名称等，所以要大于上面的值

    upload_tmp_dir = c:/upload

上传表单需要注意的事项

    指定表单编码的数据方式enctype=&quot;multipart/form-data&quot;（只有上传文件才使用这个值），并带有一些常规的信息

    提交方法必须是HTTP POST

    使用&lt;input type=&quot;file&quot;&gt;来选取上传文件

    建议加上&lt;input type=&quot;hidden&quot; name=&quot;MAX_FILE_SIZE&quot; value=&quot;1024000&quot;&gt;，单位是字节

PHP处理上传的数据

    $_POST
        处理非上传数据

    $_FILES
        处理上传文件的数据

        Array
        (
         [name] =&gt; hello.jpg
         [type] =&gt; images/pjpeg
         [tmp_name] =&gt; c:\windows\temp\php68.tmp //脚本结束时此临时文件即被删除，将此临时目录的文件用脚本移动到指定目录即完成上传
         [error] =&gt; 0
         [size] =&gt; 24485
        )

        上传文件还需注意：
        1、使用$_FILES[&quot;mypic&quot;][&quot;error&quot;]检查错误
        2、使用$_FILES[&quot;mypic&quot;][&quot;size&quot;]限制大小，单位字节 2M=pow(2,20);
        3、使用$_FILES[&quot;mypic&quot;][&quot;type&quot;]或文件的扩展名限制类型
            Apache的mime.types可以查看所有MIME类型

            list($bigtype,$smalltype)=explode(&quot;/&quot;,$_FILES[&quot;mypic&quot;][&quot;type&quot;]);
            if($bigtype!=&quot;image&quot;){

            }else{

            }
        4、将上传后的文件名改名，防止用户意外访问

            先使用is_uploaded_file()判断是否为上传文件

            再使用move_uploaded_file()移动上传文件，不使用copy() rename()等函数
</code></pre><p>文件下载</p>
<pre><code>http请求:
    1、协议和版本 HTTP 1.1
    2、头信息
    3、表单信息

http响应：
    1、状态 200 ok 404 页面没找到
    2、响应头信息
    3、数据发送

按HTTP协议的报文顺序，下述的header前不能有任何输出：
&lt;?php
    header(&quot;Content-Type:text/html;charset=utf-8&quot;);
    header(&quot;Location:two.html&quot;);
?&gt;

告诉浏览器以附件形式处理：

    header(&apos;Content-Disposition:attachment;filename=&quot;mytwo.html&quot;&apos;);
    readfile(&quot;two.html&quot;);

    header(&quot;Content-Type:image/gif&quot;);    //即使不加此行，浏览器也可能自动检测
    header(&apos;Content-Disposition:attachment;filename=&quot;logo.gif&quot;&apos;);
    header(&quot;Content-Length&quot;.filesize(&quot;logo.gif&quot;));    //即使不加此行，浏览器也可能自动检测
    readfile(&quot;logo.gif&quot;);
    readfile(&quot;two.html&quot;);
</code></pre><p>文件上传类：<br>        function __construct($options=array()){<br>            foreach($options as $key=&gt;$val){<br>                if(in_array($key,get_class_vars(get_class($this)))){<br>                    this=&gt;$key=$val;<br>                }<br>            }<br>        }</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.shenlin.ltd/2017/12/30/PHP笔记/细说 PHP - 图像处理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shenlin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="shenlin's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/30/PHP笔记/细说 PHP - 图像处理/" itemprop="url">细说 PHP - 图像处理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-30T07:06:25+08:00">
                2017-12-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>PHP图像处理</p>
<pre><code>首先安装GD库 ---lamp环境安装
php配置文件中设置php_gd2.dll
利用phpinfo查看是否支持gd库

一、画图
    验证码、统计图

    1、创建画布，为一资源类型，需要指定高度和宽度

        imagecreate();
        imagecreatetruecolor();    //推荐使用

        $img=imagecreatetruecolor(200,200);

    2、填充颜色

        imagecolorallocate();//和imagecreate()搭配使用
        imagefill(); 

        $red=imagecolorallocate(255,0,0);
        $green=imagecolorallocate(0,255,0);
        imagefill($img,0,0,);

    3、绘制图像，可绘制：
        矩形，圆、点、线段、扇形、字符、字符串、freetype字体
        上述每一个图像对应一个函数

        imagefilledrectangle
        imagerectangle
        imageline
        imagesetpixel
        imageellipse
        imagefilledellipse
        imagefilledarc

        imagefilledrectangle($img,10,10,80,80,$green);

        imagechar
        imagecharup
        imagestring
        imagestringup
        imagettftext
        iconv
            汉字gb2312的需要转换为utf-8
            使用非php的内置字体最好将字体文件复制到程序目录下
    4、输出图像或保存成文件
        输出各种类型:gif、jpg、png
        imagegif();
        imagejpeg();
        imagepng();

        header(&quot;Content-type:image/gif&quot;);
        imagegif($img);
    5、释放资源
        imagedestroy($img);

二、处理原有图像
    缩放、加水印、电子相册

    imagetypes()

    if(imagetypes() &amp; IMG_GIF){
        header(&quot;Content-type:image/gif&quot;);
        imagegif($this=&gt;image);
    }
</code></pre><p>图片处理</p>
<pre><code>裁剪、缩放、翻转、锐化、透明、旋转    

1、创建图片资源
    imagecreatefromgif(图片名称);
    imagecreatefrompng(图片名称);
    imagecreatefromjpeg(图片名称);

    imagesx();
    imagesy();
    getimagesize();
2、图形处理
    裁剪、缩放：imagecopyresized
    等比例裁剪、缩放：imagecopyresampled
         固定方案：66节 43:05
    透明处理：png、jpeg透明色都正常，只要gif不正常
         imagecolortransparent();
         imagecolorstotal();
          imagecolorsforindex();
         固定方案：66节 43:05
    加水印：文字水印、图片水印
         imagecopy();
    旋转：imagerotate();
    翻转：水平翻转、垂直翻转
        无系统函数，使用的是逐行复制图片的方式
    锐化、浮雕：imagecolorsforindex();
        imagecolorat();
        imagecolorexact();
        无系统函数，逐个获取图像像素，颜色加重后放入新图像

    开发中常用为缩放和加水印。
3、保存图片
    imagegif();
    imagepng();
    imagejpeg();
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.shenlin.ltd/2017/12/30/PHP笔记/细说 PHP - MySQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shenlin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="shenlin's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/30/PHP笔记/细说 PHP - MySQL/" itemprop="url">细说 PHP - MySQL</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-30T07:05:10+08:00">
                2017-12-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>MySql架构</p>
<pre><code>c/s结构，端口3306 

根目录下配置文件my.ini
/bin目录：存放mysql的所有命令，windows下较少
/data目录：mysql的数据库目录，一个子目录对应一个库，子目录下对应的文件为表
</code></pre><p>sql语句<br>    structured query language</p>
<pre><code>DDL,DML,DQL,DCL

mysql -h localhost -u root -p  //-p后面输入密码时不要有空格，但建议这时不输入密码，因为这时密码时明文显示，直接回车，会提示输入密码，这时会显示为*号

/s 查看mysql状态
show variables;  查看系统配置变量
show variables like &apos;ssh&apos;;
show database;
create database if not exists 库名;
    在/mysql/data目录下直接建立文件夹haha，则相当于建立了一个数据库
drop database if exists 库名;
    在/mysql/data目录下删除文件夹haha，则相当于删除了一个数据库
use 库名;    //选择一个库作为默认库
show tables;
desc 表名;    查看表结构
create table if not exists users(id int, name char(30), age int,sex char(3));
    表的3个文件：结构、数据、索引
drop table if exists 表名;
insert into users values(1,&apos;zhangsan&apos;,10,&apos;boy&apos;);
    所有的字段按字符串处理，mysql会自动转换
insert into users values(&apos;1&apos;,&apos;zhangsan&apos;,&apos;10&apos;,&apos;boy&apos;);
insert into users(id,name,age) values(&apos;2&apos;,&apos;lisi&apos;,&apos;11&apos;);
select * from users;
update users set name=&apos;wangwu&apos;,age=&apos;21&apos; where id=&apos;2&apos;;
delete from users where id=&apos;2&apos;;

? contents 查看帮助包括哪些儿内容
? data types 上面命令中列出的均可在前面加?号进行查看
? int

? show
? create table

\c 退出多行命令
</code></pre><p>创建数据库表</p>
<pre><code>create table [if not exists] 表名(
    字段名1 列类型 [属性] [索引]
    字段名2 列类型 [属性] [索引]
    ......
    字段名n 列类型 [属性] [索引]
) [表类型] [表字符集];

SQL语句不区分大小写，但是一个表对应x个文件名，windows不区分大小写，linux区分大小写，自己定义的名称最好都小写，SQL语句都大写。    

列类型：

    细分都是按空间大小来区分的

    数据库的数据量大，空间分配不合理会造出很大的浪费，所以分配空间原则是能存下就可以，也因为如此数据库有很细的类型划分。

    1、数值型

        整型：
                                有符号范围        无符号范围
            =================================================================================
            非常小的整型    TINYINT        1字节    -128---127        0----255
            较小的整型        SMALLINT    2字节    -32768---32767        0----65535
            中等大小的整型    MEDIUMINT    3字节    0----16777215
            标准的整型        INT            4字节    -2147483648---2147483647
            大整数型        BIGINT        8字节

        浮点型：
            float(M,D)        4字节        //M代表总位数,D代表小数位数
            double(M,D)        8字节
            decimal(M,D)        M+2字节        //定点数，以字符串形式存放

            浮点数会四舍五入
            浮点数存在误差，是近似数，不能使用==比较
            对比较敏感数据，使用定点数处理
            定点数优点是精确，但效率低于浮点数

    2、字符串型

        char(m)        默认255个字符，固定长度字符串，长度是定义的字节数，select后回删除空格，查询速度快，浪费空间，适合数据变化不大
        varchar(m)    默认255个字符，可变长度字符串，长度是内容长度+1个字节，select后保留空格，查询速度慢，节省空间
        text    变长，最大长度2^16-1，保存大数据量文本数据
            MEDIUMTEXT
            LONGTEXT
        blob    变长，最大长度2^16-1，保存二进制数据，如照片，压缩包，电影
            MEDIUMBLOB
            LONGBLOB
        ENUM    枚举，1或2字节，一次只能用一个值
        SET    集合，1,2,3,4,8字节，一次可以用多个集合的值，中间使用“,”分开即可

    3、日期型

        DATE        YYYY-MM-DD
        TIME        hh:mm:ss
        DATETIME    YYYY-MM-DD hh:mm:ss
        TIMESTAMP
        YEAR        YYYY

        创建表时最好不要使用这些时间格式，而用整型time()保存时间，比这些时间格式方便参与运算。（？？？？）

数据字段属性
    1、unsigned    无符号，插入负值时会自动转为0
            只能用在数值型字段，即整型和浮点型
    2、zerofill    前导0，不足的位数自动用0补齐
            只能用在数值型字段，即整型和浮点型
            该字段自动应用UNSIGNED
    3、AUTO_INCREMENT    只能是整数
                数据每增加一条，字段值自动加1，删除数据后，仍从原最大值加1开始，而不是从最大值开始
                字段值不允许重复，因此定义时还需要将此列定义为key
                当插入数据为NULL 0 留空时，即自动插入值
                插入时指定了值，再插入值则从最大那个值开始加1
    4、NULL和NOT NULL
            建议：在创建表时，字段都不允许插入NULL值，因mysql的NULL转为php的值时，不一定等于&apos;&apos;或0等

    5、default
            设置默认值


索引
    1、主键索引
        primary key
        主要作用是确定数据库表中一条特定数据记录的位置，用来唯一标识一条记录
        最好为每张数据表定义一个主键。
        一个表只能指定一个主键
        主键的值不能为空

    2、唯一索引
        unique
        和主键索引一样，都可以防止创建重复的值
        不是为了提高数据操作速度
        每个表都可以有多个唯一索引

    3、常规索引
        最重要的技术，可以提升数据库的性能
        性能优化最先考虑的即常规索引
        可以提高查找的速度，会减慢数据列上插入、删除、修改的速度
        和表一样是独立的数据对象，可在创建表时创建，也可以单独使用

        create table table_carts(
            id int not null,
            id int not null,
            id int not null,
            id int not null,
            primary key(id),
            index cuid(uid),    //index 和 key是同义词，因此这行和下面的一行都是创建索引
            key csid(sid),
        );
        create index ind1 on users(name,age);

        drop index ind1 on users;

    4、全文索引
        fulltext类型索引，只能用在MyISAM表类型上使用
        只有在varchar、char、text文本字符串上使用
        也可以多个数据列使用
        create table books(
            id int,
            bookname varchar(30),
            price double,
            detail text not null,
            fulltext(detail,bookname),
            index ind(price),
            primary key(id)
        );

        通常sql：select * from books where bookname like &apos;%php%&apos;;

        全文检索：select bookname,price from books where MATCH(detail) AGAINST(&apos;php&apos;);
              select match(detail) against(&apos;php&apos;) from books;


表类型和存储位置

    mysql和大多数据库不同，mysql有一个存储引擎的概念

    mysql可以针对不同的需求选择最优的存储引擎

    通常也把支持的存储引擎叫数据表类型

    使用show engines查看mysql支持的数据引擎，12种，缺省为MyISAM

    也可使用show variables like &apos;table_type&apos;;查看表类型，即引擎类型

    重要的表类型有：MyISAM 和 InnoDB

    create table() type InnoDB;
    或
    create table() engine InnoDB;

    在一个mysql库中可以有不同的表类型

    MyISAM表类型特点：
        成熟、稳定、易于管理
        OPTIMIZE TABLE 表名;  优化碎片
        强调快速读取操作

        缺点是有些儿功能不支持

    InnoDB表类型特点：

        支持一些儿MyISAM所不支持的功能

        缺点是空间占用较多，读写速度比MyISAM慢

    功能            MyISAM                InnoDB
    ==================================================================
    事物处理        不支持                支持
    数据化锁定        不支持                支持
    外键约束        不支持                支持
    表空间占用        相对小                相对大，最大2倍
    全文索引        支持                不支持


    存储位置：
        MyISAM文件：
              .frm    存储表结构
              .MYD    存储数据
              .MYI    存储索引
        InnoDB文件
            只有.frm文件，既存表结构，又存数据和索引（？？？）

MySQL默认字符集

    GBK    定长的字符集，是否汉字都占2字节
    UTF-8    变长的字符集，1到4个字节，每个汉字3个字节

    MySQL服务器、数据库、表、字段都可以指定字符集，36个

    显示字符集show character set;

    注意数据库中的utf-8没有-

    MySQL的字符集包括

        字符集：用来定义MySQL存储字符串的方式

        校对规则：是对规则定义了比较字符串的方式
            以_ci结尾的校对规则表示区分大小写
            以_cis结尾的校对规则表示不区分大小写
            以_bin结尾的校对规则表示进行二进制比较

        一对多的关系，一个字符集可以对应多个校对规则

        查看对应关系：show collation like &apos;%gbk%&apos;;

    create database demo default character set gbk collate gbk_chinese_ci;
    create table t1(id int) type=InnoDB default character set gbk collate gbk_chinese_ci;
    alter database demo character set utf8;

     客户端与服务器交互时：
        character_set_client
        character_set_connection
        character_set_results

    mysqldump -u root -p --default-character-set=gbk -d demo1 &gt; c:\demo.sql
    mysql -u root -p demo1 &lt; c:\demo.sql

        set names 字符集 同时修改以上三个的值
</code></pre><p>修改表</p>
<pre><code>alter table t1 add name varchar(30) not null;
alter table t1 add age int unsigned not null default &apos;0&apos;;
alter table t1 add sex varchar(10) not null after name;
alter table t1 add height double first;

alter table t1 modify sex char(3); //modify更改类型，change改名字
alter table t1 change name1 name2 varchar(30);
alter table t1 rename as users;

alter table t1 drop age;
drop table if exists t1;
</code></pre><p>insert into 表名([字段列表]) values(值列表1),values(值列表2),values(值列表3);</p>
<p>truncate 表名;    </p>
<p>select [all | distinct]</p>
<pre><code>distinct不是针对一列数据的，是针对整个查询列表取消重复的一列，在多个字段时表示字段的组合不相同

select distinct a,b from t1

select version(),1.2*10;
    上述sql中的括号，*等在嵌入到php中时，可能会产生问题，要使用别名

逻辑运算符
    &amp;&amp; and
    || or
    !  not

比较运算符
    =    --sql中的等于是一个等号
    &lt;=&gt;    和=作用相同，但可以用于null值判断，而=不可以，需要使用is null 判断
    != &lt;&gt;
    &lt;
    &lt;=
    &gt;
    &gt;=
    is null
    is not null
    between and    包括两个边界
    not between and
    like    两个通配符：下划线_ 表示任意一个字符；%表示0个或多个字符
    not like
    in
    regexp rlike
</code></pre><p>from</p>
<p>where</p>
<p>group by </p>
<p>having<br>    分组后的条件判断<br>    select cid,count(*) from t group by cid having cid &gt; 200;</p>
<p>order by </p>
<p>limit<br>    单独从句，用于限制条数</p>
<pre><code>select * from t order by a desc limit 0,5;
</code></pre><p>窄表 宽表 疑惑<br>笛卡尔连接</p>
<p>Mysql中的内置系统函数</p>
<pre><code>字符串函数

    concat(s1,s2.....sn) 把传入的参数连接为字符串
        concat &quot;abc&quot;,&quot;xyz&quot;
        select concat(name,&quot; age is&quot;,age);

    insert(str,x,y,str1) 将字符串str的x（下标从1开始）位置开始，y个长度的字符串替换为str1

    replace(str,a,b) 将字符串str的a替换为b

    lower()  upper()

    left(str,x)  right(str,x)

    lpad(str,n,pad)  rpad(str,n,pad) 用字符串pad对str最左边或最右边进行填充，直到字符串长度为n

    trim() ltrim() rtrim()

    strcmp(s1,s2) 按ascii码比较字符串，s1&gt;s2 返回1 s1=s2 返回0 s1&lt;s2 返回-1

    substring(str,x,y) 返回字符串中的第x位置起y个长度的字符串

数值函数
    abs(x)
    ceil(x) 返回大于x的最小整数
    floor(x) 返回小于x的最大整数
    mod(x,y) 返回x除以y的余数
    rand() 返回0-1之间的小数
    round(x,y) 返回参数x的四舍五入值，小数长度为y位
    truncate(x,y) 返回数字x截断为y位小数的结果，相对于上面的round，不会四舍五入

日期函数
    curdate 返回当前日期
    curtime() 返回当前时间
    now()    返回当期日期和时间
    unix_timestamp(now())    返回当前的unix时间戳
    from_unixtime(129344485) 返回时间戳对应的日期
    week(now())
    year(now())
    hour(now())
    minute(now())
    monthname(now()) 月份名字，为英文，如December
    date_format(now(),&quot;%Y-%m-%d %H:%i:%s&quot;);

流程控制函数

    if(value,t,f)   --value为真，返回t，否则返回f
    ifnull(value1,value2)    --不是null返回value1，是null返回value2
    case 
        when [value1] then [result1] 
        when [value2] then [result2] 
        when [value3] then [result3] 
        ... 
        else [value] 
    end

其他函数
    database    返回当前数据库名
    version        返回当前mysql版本
    user        返回当前的登录用户
    inet_aton(ip)    返回IP地址对应的网络字节
    inet_ntoa    返回网络字节对应的IP地址
    password    返回41位长的加密字符串，用于mysql系统用户的密码加密
    md5
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.shenlin.ltd/2017/12/29/PHP笔记/细说 PHP - 数组/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shenlin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="shenlin's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/29/PHP笔记/细说 PHP - 数组/" itemprop="url">细说 PHP - 数组</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-29T10:55:53+08:00">
                2017-12-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>数组概述<br>    1、数组的本质是声明和操作一批变量，成批处理<br>    2、数组是php支持的8种数据类型中的复合类型<br>    3、数组可以存储任意长度的数据，也可以存储任意类型的数据<br>    4、php的数组可以完成其他语言中很多数据结构的功能，如链表、队列、栈、集合类等。</p>
<p>数组的分类：<br>    1、一维数组，二维数组，三维数组，多维数组<br>    2、php数组又可分为索引数组和关联数组<br>        索引数组：下标使用整数做为索引<br>        关联数组：下标使用字符串作为索引</p>
<p>数组多种声明方式：<br>    1、直接为数组元素赋值<br>        $user[0]=1;<br>        $user[1]=”zhangsan”;<br>        $user[2]=10;<br>        echo “<pre>“;<br>        echo print_r($user);<br>        echo “</pre>“;</p>
<pre><code>    上面的索引下标也可以不写，即：
    $user[]=1;
    $user[]=&quot;zhangsan&quot;;
    $user[]=10;
    也会自动从0开始索引，结果和上面的效果相同
    如果给出下标，下一个的索引是最大索引值加1，如
    $user[]=1;        ---&gt;这里索引是0
    $user[]=&quot;zhangsan&quot;;    ---&gt;这里索引是1
    $user[5]=10;
    $user[]=&quot;boy&quot;;    ---&gt;这里索引是6

    使用字符串下标：
    $user[&quot;num&quot;]=1;
    $user[&quot;name&quot;]=&quot;zhangsan&quot;;
    $user[&quot;age&quot;]=10;
    $user[&quot;sex&quot;]=&quot;boy&quot;;

    但将索引数组和关联数组混合声明时，关联数组的声明不影响索引下标的声明
    $user[&quot;num&quot;]=1;
    $user[&quot;name&quot;]=&quot;zhangsan&quot;;
    $user[1]=10;
    $user[&quot;sex&quot;]=&quot;boy&quot;;

2、使用array()函数
    1、默认是索引数组
        $user=array(1,&quot;zhangsan&quot;,10,&quot;boy&quot;);
    2、声明关联数组需使用=&gt;指定键值对
        $user=array(&quot;id&quot;=&gt;1,&quot;name&quot;=&gt;&quot;zhangsan&quot;,12=&gt;10,&quot;boy&quot;);
        其中前两项声明为了关联数组，后两项声明为了索引数组，且指定了下标从12开始

    3、声明二维、三维数组
        $user=array(array(1,&quot;zhangsan&quot;,10,&quot;boy&quot;),array(1,&quot;lisi&quot;,10,&quot;boy&quot;),array(1,&quot;wangwu&quot;,10,&quot;boy&quot;));

        $info=array(
                &quot;user&quot;=&gt;array(
                    array(1,&quot;zhangsan&quot;,10,&quot;boy&quot;),
                    array(2,&quot;lisi&quot;,10,&quot;boy&quot;),
                    array(3,&quot;wangwu&quot;,10,&quot;boy&quot;),
                ),
                &quot;score&quot;=&gt;array(
                    array(1,&quot;zhangsan&quot;,10,&quot;boy&quot;),
                    array(2,&quot;lisi&quot;,10,&quot;boy&quot;),
                    array(3,&quot;wangwu&quot;,10,&quot;boy&quot;),
                ),
                &quot;class&quot;=&gt;array(
                    array(1,&quot;zhangsan&quot;,10,&quot;boy&quot;),
                    array(2,&quot;lisi&quot;,10,&quot;boy&quot;),
                    array(3,&quot;wangwu&quot;,10,&quot;boy&quot;),
                )
            );
3、使用其他的函数声明
    file();
</code></pre><p>数组的多种遍历方式：</p>
<pre><code>1、使用for语句
    数组必须是索引数组，且下标是连续的，但php下标可不连续，且可能是关联数组，故这种方式不是php首先方式

    $user=array(1,&quot;zhangsan&quot;,10,&quot;boy&quot;);
    for($i=0;$i&lt;count($user);$i++){
        echo &quot;\$user[{$i}]=&quot;.$user[i].&quot;&lt;br&gt;&quot;;
    };

2、使用foreach语句

    foreach(数组变量 as 变量值){
        //循环体
    }

    循环次数由数组的元素个数决定
    每一次循环都会将数组中元素分别赋值给后面变量

    foreach($user as $var){
        echo $var.&quot;&lt;br&gt;&quot;;
    }

    foreach循环时也可获得下标

    foreach(数组变量 as 下标变量=&gt;变量值){
        //循环体
    }

    foreach($user as $key=&gt;$var){
        echo $key.&quot;-------&quot;.$var.&quot;&lt;br&gt;&quot;;
    }

3、使用while() list() each()组合

    each()函数
        1、需要一个数组做参数
        2、返回值也是一个数组
        3、返回来的数组有0,1,key,value四个下标
            0和key下标是当前数组元素的键
            1和value下标是当前数组元素的值
        4、默认当前元素是第一个元素，执行一次就向后移动一个元素，到最后取不到元素时返回false

        $user=array(&quot;id&quot;=1,&quot;name&quot;=&gt;&quot;zhangsan&quot;,&quot;age&quot;=&gt;10,&quot;sex&quot;=&gt;&quot;boy&quot;);
        while($arr=each($user)){
            echo $arr[0].&quot;=&gt;&quot;.$arr[1].&quot;&lt;br&gt;&quot;;
            echo $arr[&quot;key&quot;].&quot;=&gt;&quot;.$arr[&quot;value&quot;].&quot;&lt;br&gt;&quot;;
        }

    list()函数
        1、需要将数组赋值给这个函数
        2、数组中的元素个数，要和list()函数中的参数个数相同
        3、数组中的每个元素值会按索引顺序赋值给list函数中的每个参数，list将每个参数转为变量
        4、只能接受索引数组

        list($name,,$sex)=array(&quot;zhangsan&quot;,10,&quot;boy&quot;);
        echo $name.&quot;----&quot;.$sex;

    list()和each()组合使用

        $user=array(&quot;id&quot;=&gt;1,&quot;name&quot;=&gt;&quot;zhangsan&quot;,&quot;age&quot;=&gt;10,&quot;sex&quot;=&gt;&quot;boy&quot;);

        while(list($key,$value)=each($user)){
            echo $key.&quot;=&gt;&quot;.$value.&quot;&lt;br&gt;&quot;;
        }

    数组内部指针控制函数

        next(数组);    //移到下一个元素
        prev(数组);
        reset(数组);    //移到第一个元素
        end(数组);

        current(数组);    //获取当前元素value
        key(数组);    //获取当前元素key
</code></pre><p>php中预定义的超全局数组</p>
<pre><code>1、包含了来自web服务器端、客户端、运行环境和用户输入的数据
2、在全局范围内可以直接使用
3、用户不能自定义这些儿数组
4、在函数内不用使用global关键词导入即可直接使用

$_GET
    经由url请求提交至服务器脚本的变量，长度限制8092字节
    &lt;a href=&quot;demo.php?username=ssl&amp;age=10&amp;sex=boy&quot;&gt;go&lt;/a&gt;
    可以直接使用同名的变量接收，即
    echo $username;
    echo $age;
    echo $sex;
    但一般为安全起见，这个选项在php配置文件中是关掉的，建议使用$_GET
    echo $_GET[&quot;username&quot;];
    echo $_GET[&quot;age&quot;];
    echo $_GET[&quot;sex&quot;];
$_POST
    经由HTTP POST方法至服务器脚本的变量
$_COOKIE

$_REQUEST 
    经由GET、POST和COOKIE机制提交到脚本的变量，当不确定用户提交数据的机制时使用此数组
$_FILES
    经由HTTP POST上传文件提交到脚本的变量
$_SESSION

$_ENV
    执行环境提交到脚本的变量
$_SERVER
    此数组中保存的变量由web服务器设定 或 直接和当前脚本的执行环境相关联
$GLOBALS
    当前脚本所有有效地变量，包括所有超全局数组如$_GET,$_POST...和当前脚本文件中用户定义的全局变量如$a,$b，键名也分别为超全局数组变量名称和全局变量名，也因此在函数中，访问全局变量$a，除了可以使用global $a;包含后使用外，还可以直接使用$GLOBALS[&quot;a&quot;]使用。
</code></pre><p>数组的相关处理函数：</p>
<pre><code>一、数组键值操作函数
    1、array_values()
    2、array_keys()
    3、in_array()
    4、array_key_exists()
    5、array_flip()
    6、array_reverse()

二、统计数组元素的个数和唯一性的函数
    1、count(); sizeof();
    2、array_count_values();
    3、array_unique();

三、使用回调函数处理数组的函数
    1、array_filter();
    2、array_walk();
    3、array_map();

四、数组的排序函数
    1、根据元素值对数组排序（忽略键值）
        sort();rsort();
    2、根据键名对数组排序
        ksort(); krsort();
    3、根据元素值对数组排序（保留键值）
        asort(); arsort();
    4、根据自然排序法对数组排序，字母按a到z，数字按1到9
        natsort(); natcasesort();
    5、根据用户自定义规则对数组排序
        usort(); uasort(); uksort();
    6、多维数组排序
        array_multisort();

五、数组的拆分、合并、分解、结合的数组函数
    1、array_slice();
    2、array_splice();
    3、array_combine();
    4、array_merge();
    5、array_intersect();
    6、array_diff();
    x、+ 比较下面的输出
        $a1=array(1,2,3,4);
        $a2=array(5,6,7,8);
        $a3=$a1+$a2;
        print_r($a3);

        $a1=array(1,2,3,4);
        $a2=array(10=&gt;5,6,7,8);
        $a3=$a1+$a2;
        print_r($a3);

六、数组与数据结构的函数
    1、使用数组实现堆栈
        入栈：$arr[]=&quot;a&quot;; 和这句效果相同，但比这句效率高array_push($arr,&quot;a&quot;);
        出栈：$value=array_pop($arr); 注意：$arr[0]只是读取不是出栈
    2、使用数组实现队列
        array_unshift($arr,&quot;c&quot;,&quot;d&quot;);
        $value=array_shift($arr);
    3，使用数组实现链表
        unset($arr[5]);    

七、其他与数据操作有关的函数
    1、array_rand();
    2、shuffle();
    3、array_sum();
    4、range();    //除了是数字还可以是字母，如range(&quot;a&quot;,&quot;k&quot;);
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.shenlin.ltd/2017/12/29/PHP笔记/细说 PHP - 常量和变量/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shenlin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="shenlin's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/29/PHP笔记/细说 PHP - 常量和变量/" itemprop="url">细说 PHP - 常量和变量</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-29T10:45:03+08:00">
                2017-12-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>变量的声明</p>
<p>变量的声明<br>    使用一个美元符号后跟变量名来表示: <code>$变量 = 值</code><br>    以字母或下划线开头，后面跟数字、字母或下划线<br>        这里的字母除了小写a-z和大写A-Z外，还包括ASCII码从127到255（0x7f-0xff）的字符，是一些乱七八糟的字符使用chr输出后也看不到<br>        因此可声明为php变量的字符个数为：小写字母26+大写字母26+数字10+下划线1+ASCII从127到255的129个=182个，其中常用的为63个，开头的为52个<br>        鉴于上述描述，php变量的正则可描述为<code>/^[a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*/</code><br>        变量名中可以使用中文</p>
<p>变量的赋值<br>    分为传值赋值和引用赋值两种<br>    默认总是为传值赋值<br>    将&amp;符号加到要赋值的原变量前，即为引用赋值<br>        $a=&amp;$b;<br>    只有有名字的变量才可以引用赋值：<br>        $a=&amp;(10*18);    //错误，引用了没有名字的表达式<br>        $a=&amp;test();    //错误</p>
<p>变量的初始化</p>
<pre><code>php的变量不需要初始化，但未初始化的php变量会发出E_NOTICE错误，但是在向一个未初始化的数组附加单元时不会
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$str.=<span class="string">"aaa"</span>;</span><br><span class="line">$int+=<span class="number">10</span>;	</span><br><span class="line">$float+=<span class="number">1.11</span>;</span><br><span class="line"><span class="keyword">echo</span> ($bool?<span class="string">'true'</span>:<span class="string">'false'</span>);	<span class="comment">//以上均会发生E_NOTICE错误</span></span><br><span class="line">$arr[]=<span class="number">11</span>;			<span class="comment">//这个不会</span></span><br></pre></td></tr></table></figure>

未初始化php变量的值是其类型的默认值：字符串为空，布尔值为false，整型和浮点型为0，数组为空数组
依赖未初始化变量的默认值可能会产生问题
</code></pre><p>变量的生命周期和isset语言结构</p>
<pre><code>变量在使用之前，是不存在的，即还未创建到内存，使用isset判断则返回false
变量在第一次使用时，则被自动创建到内存，同时获得了一个与应用环境对应的类型，若这时没有指定变量值，则返回类型的默认值（不同于其他语言如C，不指定变量值时，其默认值是指向的内存空间中的垃圾值），这时isset返回true
销毁的变量的方法：设置变量值为null $a=null;
          使用unset方法 unset($a);
无论使用哪种方法，销毁变量后isset返回false
还有一种特殊情况，变量已被创建到内存，但其值为null，则isset也返回false

isset语言结构
    判断一个变量是否存在 同时 变量存在时其值是否为null
    只能用于判断变量，不能传表达式、函数等
    参数的个数不限，当多个参数时，从左到右分别判断各参数的值(遇到false就停止)，进行&amp;&amp;运算，返回整个isset的值

总结isset：
    变量已被创建到内存且其值不为null时返回true
</code></pre><p>empty语言结构</p>
<pre><code>未创建的变量使用empty判断不会发生notice错误，返回值为true
变量已创建，当其值为类型的默认值时，返回值为true

访问一个不存在的数组元素时，is_null等函数会发生错误，而语言结构isset和empty则不会，使用isset和empty对数组和元素检测

    <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$item = <span class="keyword">array</span>(); </span><br><span class="line">    <span class="comment">//Now isset($item) returns true. But isset($item['unicorn']) is false.</span></span><br><span class="line">    <span class="comment">//empty($item) is true, and so is empty($item['unicorn']</span></span><br><span class="line"></span><br><span class="line">$item[<span class="string">'unicorn'</span>] = <span class="string">''</span>;</span><br><span class="line">    <span class="comment">//Now isset($item['unicorn']) is true. And empty($item) is false. </span></span><br><span class="line">    <span class="comment">//But empty($item['unicorn']) is still true;</span></span><br><span class="line"></span><br><span class="line">$item[<span class="string">'unicorn'</span>] = <span class="string">'Pink unicorn'</span>;</span><br><span class="line">    <span class="comment">//isset($item['unicorn']) is still true. And empty($item) is still false. </span></span><br><span class="line">    <span class="comment">//But now empty($item['unicorn']) is false;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

总结empty：
    变量已被创建到内存且其值不为类型默认值时返回true
</code></pre><p>php是弱类型语言，变量的类型由存储的值确定</p>
<pre><code>变量的声明和使用都需要$
不能使用php的运算符号
可以使用系统关键字作为变量名，如$if=&quot;aa&quot;; $self=&quot;aa&quot;;  $parent=&quot;aa&quot;;但$this是一个特殊的变量，不可以被赋值
变量和常量区分大小写，但其他不区分，如函数echo和Echo是一样的
</code></pre><p>检测变量是否初始化<br>    使用isset()语言结构</p>
<p>可变变量</p>
<pre><code>一个变量的变量名可以动态设置和使用，如

&lt;?php
    $one = &quot;xxx&quot;;
    $two = &quot;one&quot;;
    $three = &quot;two&quot;;
    $four = &quot;three&quot;;

    echo $four;
    echo $$four;
    echo $$$four;
    echo $$$$four;
</code></pre><p>变量的引用赋值</p>
<pre><code>使用&amp;符号

&lt;?php
    $one = &quot;10&quot;;
    $two = &amp;$one;
</code></pre><p>变量的类型</p>
<pre><code>PHP虽是弱类型语言，但也有变量类型概念，共有8种类型，4种标量，2种特殊类型，2种复合类型

4种标量：
    整型 int integer
    浮点型 float double real
    布尔型 bool boolean
    字符串 string
2种复合类型
    数组 array
    对象 object
2种特殊类型
    资源类型 resource
    NULL类型
        表示变量没有值
        只有一个值null，不区分大小写
        判断一个变量值是否为null时，$var===null比is_null($var)快
        下列情况下，一个变量被认为是null
            未被赋值
            被赋值为null
            被unset()
        空数组和null
            空数组和null使用==进行比较时，空数组会被转为null，结果返回true
            空数组和null使用===比较时，因类型不同，一个为数组类型一个为NULL类型，返回false
            空数组使用is_null判断时，is_null只判断是不是null值，不是返回false
        变量赋值为null和被unset()的区别：
            当一个变量$a被引用传值给变量$b时
                unset()其中任意一个变量，不影响另一个变量
                    $a=123;
                    $b=&amp;$a;
                    unset($a);     //只影响$a
                    var_dump($a);
                    var-dump($b);
                将任意一个变量赋值为null，则同时影响另一个变量
                    $a=123;
                    $b=&amp;$a;
                    $a=null;     //同时影响$a和$b
                    var_dump($a);
                    var_dump($b);
            被unset()后的变量会报Undefined Variable错误，但赋值为null后的变量则不会，如下列中的is_null和var_dump都是在判断不存在变量时会报错
                $a=123;
                $a=null;
                echo is_null($a);
                var_dump($a);
            unset()可理解为将变量名从内存中抹去，而赋值为null则是将变量名对应的真实变量内容置为NULL值

关于处理未定义变量时是否报错：
    语言结构更容易忽略错误，因此语言结构处理不存在的变量并不报错，如isset,empty；但函数则报错，如is_null,var_dump

is_null和isset
    isset为语言结构，is_null为函数，因语言结构更容易忽略错误，因此isset不存在的变量并不报错，但is_null则报错（empty为语言结构也不报错var_dump为函数也报错)
    is_null判断的是表达式是否为null类型的null值，参数可以为变量或函数或表达式
    isset判断的是变量是否定义或其值是否为null
    is_null始终恰恰好是isset的相反值（只是在遇到unset的变量时is_null会报一个Notice错误）
        &lt;?php

        $quirks = array(null, true, false, 0, 1, &apos;&apos;, &quot;\0&quot;, &quot;unset&quot;);

        foreach($quirks as $var) {
            if ($var === &quot;unset&quot;) unset($var);

            echo is_null($var) ? 1 : 0;
            echo isset($var) ? 1 : 0;
            echo &quot;&lt;br&gt;&quot;;
        }

使用==松散比较时，可转换为null的值 ：false,0,Null,array(),&quot;&quot;,没初始化的变量,unset后的变量，赋值为null后的变量,无属性的对象
使用==松散比较时，可转换为empty的值：false,0,Null,array(),&quot;&quot;,没初始化的变量,unset后的变量，赋值为null后的变量,无属性的对象,&quot;0&quot;

NULL 字节（&quot;\0&quot;）并不等同于 PHP 的 NULL 常数

is_null
    注意字符串&quot;0&quot;，在empty(&quot;0&quot;)中返回true，在if(&quot;0&quot;)的逻辑判断中返回false
    判断一个未定义变量时会报错，但判断值被设置为null的变量时不报错
        is_null($a); //报错
        $b=null;
        is_null($b); //不报错


var_dump(变量或值);    既可以查看变量或数据的类型，又可以查看值


    &lt;?php

        $var = 10;

        echo &quot;&lt;pre&gt;&quot;;
        echo var_dump($var);
        echo &quot;&lt;/pre&gt;&quot;;

        echo &quot;----------------&lt;br&gt;&quot;
</code></pre><p>各种类型变量的声明</p>
<pre><code>&lt;?php
    $int = 10;    //十进制声明
    $int = 045;    //以0开头的表示8进制声明
    $int = 0xff;    //以0x或0X开头的表示16进制声明

    $float = 10;
    $float = 3.14E5
    $float = 3.14E+5
    $float = 3.14E-5    //E也可以小写

    //布尔值的声明，以下都是false的情况
    $bool = false;    //true为真
    $bool = 0;    //相反，非0的数为真
    $bool = 0.000;    //相反，有非0的数出现
    $bool = &quot;&quot;;    //相反，非空非0字符串为真
    $bool = &quot;0&quot;;//相反，非空非0字符串为真
    $bool = &quot; &quot;;//相反，非空非0字符串为真
    $bool = null;    //相反，非空代表真
    $bool = array();    //相反，非空数组为真
</code></pre><p>—————————————————————————————————————————2014-03-08<br>        //字符串有多种声明方法<br>        //1、单引号、双引号和界定符都可以声明字符串<br>        //2、声明的字符串没有长度限制<br>        //3、双引号字符串中，可以直接解析变量和使用转义字符<br>        //4、双引号中不能再使用双引号，单引号中不能再使用单引号<br>        //5、单引号字符串中，不可以解析变量，只能转义单引号本身和转义字符\本身<br>        //6、双引号中解析变量时，<br>            $var = 100;<br>            $str = “aa$varbbdddd”;<br>             解析失败，因变量$var后无明显的断点符号，如空格，加号，逗号等，例如：<br>            $str = “aa$var bbdddd”;<br>             则成功，标准方法应该是使用大括号将变量括起来，$符号可括可不括，例如：<br>            $str = “aa{$var}bbdddd${var}bbdddd”;<br>        //7、虽然双引号比单引号功能强，但最好使用单引号，原因是双引号的变量解析和转义或消耗相对多的资源<br>        //8、大量的字符串，使用定界符声明，格式为<br>        $str=&lt;&lt;&lt;hello<br>    这里是任意字符串<br>    asdfdfsdfsdfsadfsdf<br>hello;<br>        以&lt;&lt;&lt;开头，其中hello为自定义字符，第一个hello后不能有任何字符，第二个hello必须顶格写，前面不能有任何字符。<br>        //9、定界符中可以任意使用双引号、单引号，同时可以解析变量和转义字符。</p>
<p>数据类型之间的转换<br>    分为强制转换和自动转换，最常用为自动转换</p>
<pre><code>强制转换：
    1、setType(变量，类型); 
        //类型有int或integer,float,double,real,bool或boolean,string,array,object
        //这个函数将原变量的类型改变

    2、在赋值前使用(类型)的形式，不会改变原变量的类型
    $str = &quot;100.112ab&quot;;
    $var = (int)$str;    

    3、使用一些儿有针对性的转换函数
    $变量=intval(变量或值);
    $变量=floatval(变量或值);
    $变量=stringval(变量或值);

    注意：整型在内存中占4个字节，最大范围为2.147e9
        浮点型在内存中占8个字节

自动转换
    $a = 10;
    $b = 100.11;
    $c = &quot;23asd&quot;;
    $d = true;
    $sum = $a+$b+$c+d;
    echo var_dump($sum);
</code></pre><p>与变量和类型有关的一些儿常用函数</p>
<pre><code>isset();
empty();
unset();

getType();
setType();

变量类型测试函数
is_bool();
is_int() is_integer() is_long()
is_string();
is_float() is_double() is_real()
is_array()
is_object()
is_resource()
is_null()

is_scalar()
is_numeric()
is_callable()
</code></pre><p>常量的声明与使用</p>
<pre><code>define(&quot;常量名&quot;,值);

常量是一个简单值的标示符
常量不能改变其值，也不能使用unset()取消
常量可以不用理会变量范围的规则而在任何地方都可以定义和访问
常量在声明和使用时都不使用$
常量名称习惯都使用大写
常量的值只能用标量类型（int,float,bool,string）
常量一定要在声明时就给值
defined(&quot;常量&quot;); 检测某个常量是否已定义
</code></pre><p>系统的预定义常量和魔术常量</p>
<pre><code>所谓魔术，即会根据环境变化的
魔术常量以__开头，如__FILE__、__LINE__
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.shenlin.ltd/2017/12/29/PHP笔记/细说 PHP - MySQLi/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shenlin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="shenlin's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/29/PHP笔记/细说 PHP - MySQLi/" itemprop="url">细说 PHP - MySQLi</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-29T10:26:27+08:00">
                2017-12-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在PHP中使用MySQL扩展库操作数据库</p>
<pre><code>mysql_connect
mysql_pconnect
mysql_select_db
    一个页面有多个链接时，需要指定第二个参数，否则默认第二个参数为后建立的链接
mysql_query
mysql_insert_id    获取最后增长的ID
mysql_affected_rows
mysql_errno
mysq_error
mysql_close
</code></pre><p>使用PHP中mysql扩展处理结果集</p>
<pre><code>从结果集获取记录
    mysql_fetch_row        //返回索引数组，可以和list配合
        while(list($id,$name,$price)=mysql_fetch_row($result)){
            echo $id.$name.$price
        }
    mysql_fetch_assoc    //返回关联数组，下标为列名
    mysql_fetch_array    //返回索引和关联两个数组
    mysql_fetch_object    //将一条记录以对象的形式返回

    使用一次就从结果集中取出一条记录，取完后将指针移动到下一条记录，默认为第一条记录，到结尾则返回false

    mysql_data_seek
        移动结果集的指针

获取行列的信息
    mysql_num_fields
    mysql_filed_name
    mysql_num_rows

释放结果集
    mysql_free_result

翻页类：
$_SERVER[&quot;REQUEST_URI&quot;]
parse_url
parse_str
http_build_query
</code></pre><p>PHP的mysqli扩展库操作MySQL数据库</p>
<pre><code>从php5.0开始可以使用mysqli，i表示改进
mysqli是一个面向对象的技术，但也支持过程化的使用方式，建议使用面向对象开发
相对mysql改进：
    1、功能增加
    2、效率提高，新项目建议使用mysqli
    3、更稳定

使用mysqli需要：
    为php安装mysqli扩展
    在php的配置文件中打开mysqli的扩展

mysqli提供了三个类：
    1、mysqli
        和连接有关的类
    2、mysqli_result
        和结果集有关的类

        上述mysqli的两个类即完成了mysql的功能
    3、mysqli_stmt
        预处理类

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$mysqli=@<span class="keyword">new</span> mysqli(<span class="string">"localhost"</span>,<span class="string">"root"</span>,<span class="string">"123"</span>,<span class="string">"mydb"</span>); <span class="comment">//注意new前的@屏蔽了错误输出</span></span><br><span class="line"><span class="keyword">if</span>(mysqli_connect_errno())&#123;</span><br><span class="line">	<span class="keyword">echo</span> mysqli_connect_error();</span><br><span class="line">	$mysqli=<span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> $mysqli-&gt;character_set_name().<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> $mysqli-&gt;get_client_info().<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> $mysqli-&gt;host_info.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> $mysqli-&gt;server_info.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> $mysqli-&gt;server_version.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"></span><br><span class="line">$result=$mysqli-&gt;query($sql);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$result)&#123;</span><br><span class="line">	<span class="keyword">echo</span> $mysqli-&gt;errno.$mysqli-&gt;error;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $mysqli-&gt;affected_rows;</span><br><span class="line"><span class="keyword">echo</span> $mysqli-&gt;insert_id;</span><br></pre></td></tr></table></figure>
</code></pre><p>使用PHP中mysqli扩展处理结果集</p>
<pre><code>$result-&gt;num_rows;
$result-&gt;field_count;

$result-&gt;fetch_row;
$result-&gt;fetch_assoc;
$result-&gt;fetch_array;
$result-&gt;fetch_object;

$result-&gt;data_seek(5);

$result-&gt;fetch_field();
$result-&gt;fetch_fields();
$result-&gt;field_seek();

$result-&gt;free();
$result-&gt;free_result();
$mysqli-&gt;close();
</code></pre><p>使用PHP的mysqli扩展完成事务处理和一次执行多条SQL语句</p>
<p>使用PHP的mysqli扩展中预处理语句</p>
<p>   1、多条语句</p>
<pre><code>$mysqli-&gt;multi_query(&quot;sql1;sql2;sql3;&quot;);
do{

    $result-&gt;$mysqli-&gt;store_result();

    if($mysqli-&gt;more_results()){
        echo &quot;还有结果集&quot;;
    }
}while($mysqli-&gt;next_result());
</code></pre><p>   2、事务</p>
<pre><code>目前只有InnoDB 和 BDB 表类型支持事务

默认表都是自动提交的(autocommit)，因此使用事务需要先关闭自动提交，改为手动提交

命令行中的操作：
    1、关闭自动提交
        set autocommit=0;
    2、开启事务
        start transaction;
    3、提交
        commit;
    4、回滚
        rollback;
程序中的操作：
    1、关闭自动提交
        $mysqli-&gt;autocommit(0);
    2、开启事务
        start transaction;
    3、提交
        $mysqli-&gt;commit();
    4、回滚
        $mysqli-&gt;rollback();
    5、开启自动提交
        $mysqli-&gt;autocommit(1);
</code></pre><p>   3、mysqli中其他类成员的使用</p>
<pre><code>更改字符集
    $mysqli-&gt;query(&quot;set names gb2312&quot;);
    $mysqli-&gt;query(&quot;insert into t1(id,name) values(1,{$_GET(&quot;prname&quot;)})&quot;);

    $mysqli-&gt;set_charset(&quot;utf8&quot;);
</code></pre><p>使用PHP的mysqli扩展中预处理语句</p>
<pre><code>预处理类mysqli_stmt，和mysqli，mysqli_result相比优点：
    1、mysqli和mysqli_result完成的功能，都能使用mysqli_stmt完成
    2、效率高，编译一次，执行多次
    3、安全，使用问号占位符防止sql注入
因此推荐使用

第一种方法：
    $stmt=$mysqli-&gt;stmt_init();

    $sql=&quot;insert into t1(id,name,price,desn) values(?,?,?,?)&quot;;
        sql中的?即为问号占位符

    $stmt-&gt;prepare($sql);

第二种方法：
    $stmt=$mysqli-&gt;prepare($sql);


给占位符的每个?传值，也称为绑定参数
    $stmt-&gt;bind_param(&quot;idsb&quot;,$a,$b,$c,$d);
        i   corresponding variable has type integer
        d   corresponding variable has type double
        s   corresponding variable has type string
        b   corresponding variable is a blob and will be sent in packets

        $a,$b,$c,$d必须传变量，不能直接传值，因为这里的参数需要是引用


执行，可以先绑定参数，后为参数赋值
    $a=&quot;1&quot;;
    $b=&quot;2&quot;;
    $c=&quot;3&quot;;
    $d=&quot;4&quot;;
    $stmt-&gt;execute();

    $a=&quot;1&quot;;
    $b=&quot;2&quot;;
    $c=&quot;3&quot;;
    $d=&quot;4&quot;;
    $stmt-&gt;execute();

    $a=&quot;1&quot;;
    $b=&quot;2&quot;;
    $c=&quot;3&quot;;
    $d=&quot;4&quot;;
    $stmt-&gt;execute();
释放
    $stmt-&gt;close();


处理结果集
    $stmt=$mysqli-&gt;prepare(&quot;select id,name,price from t1 where id &gt; ?&quot;);

    $stmt-&gt;bind_param(&quot;i&quot;,$id);

    $stmt-&gt;bind_result($id,$name,$price);    //将每一列绑定到对应的变量

    $id=99;

    $stmt-&gt;execute();

    $stmt-&gt;store_result();    
        //一次性将结果取过来，没有这条语句则是逐条取，效率低，且下面的data_seek方法和num_rows都无法正确执行

    $result=$stmt-&gt;result_metadata();
        //此方法虽返回的是mysqli_resul结果集对象，但只能使用获取字段的方法

    while($field=$result-&gt;fetch_field){
        echo $field-&gt;name;
    }

    $stmt-&gt;data_seek(2);

    while($stmt-&gt;fetch()){        //循环取每一行

        echo $id.$name.$price;

    }

    echo $stmt-&gt;num_rows;

    $stmt-&gt;free_result();

    $stmt-&gt;close();
</code></pre><p>PHP中使用MySQL的视图</p>
<pre><code>什么是视图
    视图是存放数据的一个接口，是虚拟表
    数据来自一个或几个基表或视图，也可以是用户自己定义的数据
    视图并不存放数据，数据还是存放在基表中
    基表数据发送变化，视图数据也随之变化；视图数据变化，基表数据也变化

视图的作用
    1.视图可以让查询变得很清楚，让复杂的sql语句变得简单
    2.保护数据库的重要数据，给不同的人看不同的数据，可从基表中选择特定的字段生成视图，然后为用户分配此视图的权限，但基表不分配权限，则限制了用户查看数据的权限。

视图分类
    定制视图
    传参视图 

    merge
        会将引用视图的语句
    temptable
    undefined

    [with [cascaded|local] check option]

创建视图
    create [or replace] [algorithm={merge|temptable|undefined}]
    view view_name [(column_list)]
    as select_statement
    [with [cascaded|local] check option]

    create view student_view as select * from student; 

    创建或替换视图（弱同名视图已存在）
    create or replace view student_view as select id,name,age from student;

    指定视图字段名，注意字段名中有空格时使用的是反引号
    create view student_view(`编 号`,名字,年龄) as select id,name,age from student;
        视图名不能和基表名相同
        只有一个frm的结构存储文件

更改视图

     alter view student_view as select * from student; 

删除视图

    drop view student_view;

查看视图

    show tables;
    desc student_view;
    show table status like &apos;student_view&apos; \G;
    show create view student_view \G;
    select * from information_scheme \G;

web开发中使用视图

    登录时的用户名、密码字段放一个视图中
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.shenlin.ltd/2017/12/29/PHP笔记/细说 PHP - PDO/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shenlin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="shenlin's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/29/PHP笔记/细说 PHP - PDO/" itemprop="url">细说 PHP - PDO</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-29T10:24:12+08:00">
                2017-12-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>PDO的介绍安装及对象初使化</p>
<pre><code>PDO:PHP Data Object

php处理不同的数据库需要调用不同的数据库扩展，如mysql,mysqli,orace,mssql等，这些扩展的调用方法虽然类似但不尽相同，在需要将数据从一个类型数据库移植到另一个类型数据库时，首先要使用工具将数据移动过去，然后最重要的是要修改程序中的数据调用方法，这是最烦琐最大量的工作，也因此，跨数据库的pdo应运而生，类似的技术还有adodb和mdb2，但pdo相对来说更高效。

pdo是基于驱动的(adodb不是)，并不是pdo扩展本身去访问不同的数据库，而是安装对应数据库的pdo驱动，如pdo_mysql对应mysql的驱动

启用pdo：
    安装pdo扩展
    安装对应数据库的驱动
    php配置文件中打开对应的驱动

pdo的三个类
    PDO
        和数据库连接有关的类
    PDOStatement
        处理准备语句和结果集
    PDOException
        处理异常

PDO很多常量

创建PDO对象
    $pdo=new PDO($dsn,$username,$pwd);
        dsn data source name 

        数据源，包括主机位置、库名、连接哪种数据库驱动三种信息
        各数据库dsn的写法不同，可参考帮助
        可将dsn写入文件中或写入配置文件中，用户切换数据库时方便：
            pdo.dsn.mysqlpdo=mysql:host=localhost;dbname=demo

    try{

        $pdo=new PDO(&quot;mysql:host=localhost;dbname=demo&quot;,&quot;root&quot;,&quot;123456&quot;);

    }catch(PDOException $e){

        echo $e-&gt;getMessage();
        exit;
    }

    echo $pdo-&gt;getAttribute(PDO::ATTR_CLIENT_VERSION).&quot;&lt;br&gt;&quot;;

    $pdo-&gt;setAttribute(PDO::ATTR_AUTOCOMMIT,0);

    也可用第四个参数设置PDO的常量：

        $pdo=new PDO($dsn,$username,$pwd,array(PDO::ATTR_AUTOCOMMIT-&gt;0));
</code></pre><p>PDO对象中方法的使用详细介绍</p>
<pre><code>exec()
    执行有影响行数的sql
    返回影响的行数

    获取最后自增长ID：$pdo-&gt;lastInsertId();
query()
    执行有结果集的sql
    返回的是预声明对象???，支持foreach遍历
prepare()


三种错误模式：？？？
    PDO::ERRMODE_SILENT
        默认模式下sql有错误不提示，需要使用错误函数获取错误信息
        errorcode
        errorinfo
    PDO::ERRMODE_WARNING
        警告模式下trycatch不会捕获到异常
    PDO::EXCEPTION
        异常模式下可以抓取到异常

事务：
    $pdo-&gt;setAttribute(PDO::ATTR_AUTOCOMMIT,0);
    $pdo-&gt;beginTransaction();
    $pdo-&gt;commit();
    $pdo-&gt;rollback();
    $pdo-&gt;setAttribute(PDO::ATTR_AUTOCOMMIT,1);
</code></pre><p>使用PDO进行SQL语句预处理</p>
<pre><code>//准备好了一条sql语句，并放到服务器端编译过了
$stmt=$pdo-&gt;prepare(&quot;insert into t1(id,name,age,sex) values(?,?,?,?)&quot;);    
$stmt=$pdo-&gt;prepare(&quot;insert into t1(id,name,age,sex) values(:id,:name,:age,:sex)&quot;);    
    返回的就是预处理类PDOStatement对象
    和mysqli的占位符只支持?占位符不同，这里也支持名字占位符
    ?占位符是按索引顺序使用，名字占位符则是按名称使用，和顺序无关

//绑定名字参数
$pdo-&gt;bindParam(&quot;:id&quot;,$id,PDO::PARAM_INT);    //后面的类型是可选的，系统会自动转换
$pdo-&gt;bindParam(&quot;:name&quot;,$name);
$pdo-&gt;bindParam(&quot;:age&quot;,$age);
$pdo-&gt;bindParam(&quot;:sex&quot;,$sex);

//绑定问号参数
$pdo-&gt;bindParam(1,$id);
$pdo-&gt;bindParam(2,$name);
$pdo-&gt;bindParam(3,$age);
$pdo-&gt;bindParam(4,$sex);

//为参数连续赋值和执行
$id=1;
$name=&quot;lisi&quot;;
$age=10;
$sex=&quot;boy&quot;;

if($stmt-&gt;execute()){
    //获取最后插入ID
    echo $pdo-&gt;lastInsertId();
}

$id=2;
$name=&quot;wangwu&quot;;
$age=12;
$sex=&quot;girl&quot;;

if($stmt-&gt;execute()){
    //获取最后插入ID
    echo $pdo-&gt;lastInsertId();
}

//使用另一种方式执行，通过传递数组
$stmt=$pdo-&gt;prepare(&quot;insert into t1(id,name,age,sex) values(:id,:name,:age,:sex)&quot;);    
$stmt-&gt;execute(array(&quot;:id&quot;=&gt;1,&quot;:name&quot;=&gt;&quot;lisi&quot;,&quot;:age&quot;=&gt;10,&quot;:sex&quot;=&gt;&quot;boy&quot;));//和数组元素顺序无关
$stmt-&gt;execute(array(&quot;:id&quot;=&gt;2,&quot;:name&quot;=&gt;&quot;wangwu&quot;,&quot;:age&quot;=&gt;12,&quot;:sex&quot;=&gt;&quot;girl&quot;));

$stmt=$pdo-&gt;prepare(&quot;insert into t1(id,name,age,sex) values(?,?,?,?)&quot;);    
$stmt-&gt;execute(array(1,&quot;lisi&quot;,10,&quot;boy&quot;));//按占位符顺序传值
$stmt-&gt;execute(array(2,&quot;wuli&quot;,12,&quot;girl&quot;));
</code></pre><p>使用PDO操作结果集</p>
<pre><code>$stmt=$pdo-&gt;prepare(&quot;select * from t1 where id &gt; :id&quot;);
$stmt-&gt;execute(array(&quot;:id&quot;=&gt;12));

$stmt-&gt;setFetchMode(PDO::FETCH_NUM);

//逐条获取
while ($row = $stmt-&gt;fetch(PDO::FETCH_NUM)) {
    foreach($row as $item){
        echo $item;
    }
}

//一次性全部获取
$data=$stmt-&gt;fetchAll(PDO::FETCH_NUM);
echo print_r($data);

//通过绑定列的方式获取
$stmt-&gt;bindColumn(&quot;id&quot;,$id,PDO::PARAM_INT);    //按名字绑定
$stmt-&gt;bindColumn(&quot;name&quot;,$name);
$stmt-&gt;bindColumn(3,$age);    //按顺序绑定
$stmt-&gt;bindColumn(4,$sex);

while($stmt-&gt;fetch()){
    echo $id.$name.$age.$sex;
}

//获取总行数
echo $stmt-&gt;rowCount();

//获取总列数
echo $stmt-&gt;columnCount();

//获取列信息
for($i=0;$i&lt;$stmt-&gt;columnCount;$i++){
    $field=$stmt-&gt;getColumnMeta($i);
    echo $field[&quot;name&quot;];
}

fetch()
    默认返回的数据包含了索引和关联数组
    通过制定常量参数可以设置返回的数组
        PDO::FETCH_NUM
        PDO::FETCH_ASSOC
        PDO::FETCH_BOTH
    也可以通过设置获取模式来设置
        $stmt-&gt;setFetchMode(PDO::FETCH_NUM);

fetchColumn
    获取单列
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.shenlin.ltd/2017/12/29/PHP笔记/细说 PHP - 会话控制 Cookie 和 Session/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shenlin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="shenlin's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/29/PHP笔记/细说 PHP - 会话控制 Cookie 和 Session/" itemprop="url">细说 PHP - 会话控制 Cookie 和 Session</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-29T10:22:14+08:00">
                2017-12-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="基于Cookie的会话控制"><a href="#基于Cookie的会话控制" class="headerlink" title="基于Cookie的会话控制"></a>基于Cookie的会话控制</h2><pre><code>借助客户端电脑的一个文件来保存用户信息，再访问同一个网站的各个页面斗会带这些信息过去，服务器通过这些信息就能区分用户。

cookie通过http头信息传递，因此设置cookie前不能有任何输出

写入cookie
    $time=time()+3600;
    setCookie(&quot;one&quot;,&quot;111&quot;,$time);

cookie中也可保存数组
    setCookie(&quot;arr[0]&quot;,&quot;111&quot;,$time);
    setCookie(&quot;arr[1]&quot;,&quot;222&quot;,$time);
    setCookie(&quot;arr[&apos;x&apos;]&quot;,&quot;333&quot;,$time);
    setCookie(&quot;arr[&apos;y&apos;]&quot;,&quot;444&quot;,$time);

删除cookie
    $time=time()-1;
    setCookie(&quot;one&quot;);
    setCookie(&quot;two&quot;,&quot;&quot;,$time);

读取cookie
    print_r($_COOKIE);
    print_($_COOKIE[&quot;one&quot;]);
</code></pre><h2 id="使用Session进行会话控制"><a href="#使用Session进行会话控制" class="headerlink" title="使用Session进行会话控制"></a>使用Session进行会话控制</h2><pre><code>两种session：
    使用cookie保存sessionid 
    url中带有sessionid

开启session：session_start();
    分配sessionid给客户端，基于cookie的session则写入了cookie中
    证明：echo $_COOKIE[&quot;PHPSESSIONID&quot;];
    因此基于cookie的session，在此语句前不能有任何输出
    php配置文件中开启session：session.auto_start=1，则所有页面不用写session_start();但这种方式限制是不能将对象放入session中，因此不建议使用


保存数据到session
    $_SESSION[&quot;aa&quot;]=&quot;111&quot;;

读取session
    echo $_SESSION[&quot;aa&quot;];
    echo $_SESSION[session_name()];

获取sessionid
    echo session_id();

注销session
    也先要开启session：
        session_start();

    删除session数组中某个值：
        unset($_SESSION[&quot;aa&quot;]);
            不要unset($_SESSION);

    清空session：
        $_SESSION=array();

    清除cookie中的sessionid：
        isset($_COOKIE[session_name()]){
            setCookie(session_name(),&apos;&apos;,time()-1,&apos;/&apos;); //路径参数不可少
        }

    彻底销毁session
        session_destroy();

URL中传sessionid

    方案1：指定url中传sessionid的变量

        if(isset($_GET[&quot;sid&quot;])){
            session_id($_GET[&quot;sid&quot;]);
        }
        session_start();

        echo &quot;&lt;a href=&apos;/index.php?sid={session_id()}&apos;&gt;首页&lt;/a&gt;&quot;;

    方案2：url中使用session_name()传sessionid

        echo &quot;&lt;a href=&apos;/index.php?{session_name()}={session_id()}&apos;&gt;首页&lt;/a&gt;&quot;;


    方案3：使用常量SID
        浏览器支持cookie则值为空
        不支持cookie则代表了session_name和session_id的值

            echo &quot;&lt;a href=&apos;/index.php?{SID}&apos;&gt;首页&lt;/a&gt;&quot;;

    方案4：修改配置文件，使得链接自动增加sessionid，表单、链接、header跳转前都会自动增加，但？？？echo输出的链接、客户端脚本中的跳转系统检测不到？？？，需要自己添加

        session.user_trans_sid = 1
</code></pre><p>SESSION的高级用法将信息写入到自定义文件</p>
<pre><code>一、session信息写入到自定义位置

    1、解决跨机保存session
        文件系统：linux下可以使用nfs或是samba，windows下使用共享文件夹

        使用数据库

        使用memcache

        上述都需要使用函数session_set_save_handler()来实现

    2、解决在线用户信息

二、php配置文件中的常用选择

    session.name
    session.use_trans_sid
        启用SID的支持，默认值为0
    session.save_path
        session文件保存位置，session文件以sess_开头，后面是sessionid

    session.use_cookies
    session.cookie_path
    session.cookie_domain
    session.cookie_lifetime
        保存到客户端的cookie的最长时间
        默认值为0，表示关闭浏览器就删除
        设置此值后，即使用户未关闭浏览器，到时也会删除老cookie，产生新cookie

    session.save_handler
        默认值为files
        自定义位置改为：user
        保存到memcache改为：memcahe

    session.gc_maxlifetime
        gc是garbage collection垃圾回收的缩写
        指定经过多少秒后数据被视为垃圾并被清除
        用户有动作时，session_start会重新设定此时间？？？
        默认是1440秒
    session.gc_probability
        默认值1
    session.gc_divisor
        默认值100
        上面两个函数合起来使用，用于gc进程启动概率：session初始化时，即调用session_start()时，会启动垃圾回收进程来回收垃圾session，但并非超时的session这时一定被清除，因考虑到性能问题，是否清除session有个概率，即上面两值相除，如按默认值为1%。

三、session_set_save_handler()函数的使用

    修改php配置文件：session.save_handler = user

    //在运行session_start()时调用
    //启动会话
    function open($save_path,$session_name){
        global $sess_save_path;
        $sess_save_path = $save_path;
        return true;
    }

    //在调用session_write_close和session_destroy时调用
    function close(){
        return true;
    }

    //在运行session_start()和读取数据$_SESSION时
    //读取session数据到$_SESSION中
    function read($session_id){
        global $sess_save_path;
        $sess_file=$sess_save_path.&quot;mysessfile&quot;.$session_id;

        return (string)file_get_contents($sess_file);
    }

    //结束时和session_write_close()强制提交session数据时
    function write($session_id,$sess_data){
        global $sess_save_path;
        $sess_file=$sess_save_path.&quot;mysessfile&quot;.$session_id;

        if($fp=fopen($sess_file,&quot;w&quot;)){
            $return=fwrite($fp,$sess_data);
            fclose($fp);
            return $return;
        }else{
            return false;
        }

    }

    //调用session_destroy();时
    //
    function destroy($session_id){
        global $sess_save_path;
        $sess_file=$sess_save_path.&quot;mysessfile&quot;.$session_id;

        return unlink($sess_file);
    }

    //在session.gc.probability和session.gc_divisor值决定的，在open()、read()、session_start()时
    function gc($gc_maxlifetime){
        global $sess_save_path;

        foreach(glob($sess_save_path.&quot;/mysessfile_*&quot;) as $filename){
            if(filemtime($filename)+gc_maxlifetime&lt;time()){
                unlink($filename);
            }
        }
    }

    session_set_save_handler(&quot;open&quot;,&quot;close&quot;,&quot;read&quot;,&quot;write&quot;,&quot;destroy&quot;,&quot;gc&quot;,); //参数均为回调函数

    session_start();
</code></pre><p>SESSION的高级应用将信息写入到数据库中（<strong><em>*</em></strong>自己实现一遍<strong>**</strong>）</p>
<pre><code>给回调函数传值，当函数没有类中时，直接传函数名就可以
当函数在类中时，需要使用数组，第一个元素为类名，第二个元素为方法名

__class__常量代表类名
</code></pre><p>SESSION最优的应用将信息写入到Memcache中管理（<strong><em>*</em></strong>自己实现一遍<strong>**</strong>）</p>
<pre><code>memcache中set方法设置的时间可以完成session的gc完成的而工作，因此gc直接返回true

即使不自己实现session_set_save_handler的各回调方法，仅修改php配置文件也可实现：
    session.save_handler = memcache
    session.save_path=&quot;tcp://192.168.1.11:11211&quot;,&quot;tcp://192.168.1.12:11211&quot;
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.shenlin.ltd/2017/12/29/PHP笔记/细说 PHP - PHP 中使用 MemCached/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="shenlin">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="shenlin's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/12/29/PHP笔记/细说 PHP - PHP 中使用 MemCached/" itemprop="url">细说 PHP - PHP 中使用 memcached</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-29T10:20:37+08:00">
                2017-12-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PHP/" itemprop="url" rel="index">
                    <span itemprop="name">PHP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>memcached的安装及管理</p>
<pre><code>概述
    是一个高性能的分布式的内存对象缓存系统，通过在内存里维护一个巨大的hash表
    hash表是一个键值对表
    是一个c/s架构软件？？？？
    150k的开源软件，使用c语言实现
    默认端口是11211

工作原理
    Memcache    软件
    Memcached    服务进程

    Memcached是以守护进程方式运行于一个或多个服务器中，随时接收客户端的连接和操作
    客户端可使用各种语言编写，如PHP、java等

linux下安装
    memcache使用到libevent库，需要先安装此库
        ./configure-with-libevent=/usr
    安装memcache
        ./config-with-libevent=/usr
        make &amp;&amp; make install
        启动
            memcached -d -m 128 -l 192.168.1.11 -p 11211 -u root
        停止
            kill cat /tmp/memcached.pid
            或
            killall memcached

windows下安装

    memcached.exe -d install

    memcached.exe -d uninstall

    memcached.exe -d start

    memcached.exe -d -m 50 -l 127.0.0.1 -p 11211 start
操作
    telnet localhost 80    ---apache
    telnet localhost 21    ---ftpd
    telnet localhost 22    ---ssh
    telnet localhost 11211    ---memcached

命令格式
    [add | set]    键  标志位  有效时间 长度 \n值
    [get | delete]  键
    flush_all    //清空所有

遍历
    stats items
    stats cachedump 1 1
    stats cachedump 1 0
</code></pre><p>php中使用memcached</p>
<pre><code>支持过程和对象两种使用方式

安装memcached扩展
    windows系统
        将php扩展文件php_memcache.dll复制到php扩展目录ext
        在php配置文件中设置memcache扩展：extension=php_memcache.dll
        重启apache服务器
    linux系统
        ？？？？

使用
    $mem=new Memcache;
    $mem-&gt;connect(&quot;localhost&quot;,11211);
    $mem-&gt;add(&quot;mystr&quot;,&quot;this is a test&quot;,MEMCACHE_COMPRESSED,3600);
    $mem-&gt;set(&quot;mystr&quot;,&quot;this is a test&quot;,MEMCACHE_COMPRESSED,3600);
    $mem-&gt;replace(&quot;mystr&quot;,&quot;this is a test&quot;,MEMCACHE_COMPRESSED,3600);
    echo $mem-&gt;get(&quot;mystr&quot;);

    $mem-&gt;add(&quot;myarr&quot;,array(&quot;aaa&quot;,&quot;bbb&quot;,&quot;ccc&quot;));
    print_r($mem-&gt;get(&quot;myarr&quot;));

    $mem-&gt;add(&quot;myobj&quot;,new PDOException);
    var_dump($mem-&gt;get(&quot;myobj&quot;));

    echo $mem-&gt;getVersion();

    $mem-&gt;delete(&quot;mystr&quot;);
    $mem-&gt;flush();

    echo &quot;&lt;pre&gt;&quot;;
    print_r($mem-&gt;getStats());
    echo &quot;&lt;/pre&gt;&quot;;

    $mem-&gt;addServer(&quot;www.ssl.com&quot;,11221);
    $mem-&gt;addServer(&quot;192.168.1.11&quot;,11211);

    $mem-&gt;close();

在php什么地方使用memcache
    1、缓存数据库select出的数据
    2、在会话控制Session中使用

key值注意：
    1、同一个项目安装两次，key要有不同的前缀
    2、同一个sql语句可能在不同页面重复使用，可使用sql的md5值做为key，或截取部分md5值作为key

安全注意：
    1、内网访问
    2、设置防火墙
        iptables -A INPUT -p tcp -s 192.168.1.111 -dport 11211 -j ACCEPT
        iptables -A INPUT -p udp -s 192.168.1.111 -dport 11211 -j ACCEPT
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/16/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><span class="page-number current">17</span><a class="page-number" href="/page/18/">18</a><span class="space">&hellip;</span><a class="page-number" href="/page/22/">22</a><a class="extend next" rel="next" href="/page/18/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">shenlin</p>
              <p class="site-description motion-element" itemprop="description">A Programmer's Blog</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">218</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">39</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">156</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">shenlin</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
